import{c8 as g,c9 as P,r as s,bD as _,by as S,c_ as E,cw as x,c$ as M,d0 as $,cL as k,cB as R,d1 as y,a$ as v,cZ as D,d2 as U,cW as j,f as F}from"./sanity-BNM0fRy3.js";function I(u){return g(function(t,a){var i=!1,n=0;t.subscribe(P(a,function(r){return(i||(i=!u(r,n++)))&&a.next(r)}))})}const L=u=>{const{comlink:t,refs:a,perspective:i}=u,n=_(),r=S(),p=s.useMemo(()=>new E,[]),b=s.useMemo(()=>p.asObservable().pipe(x(d=>$(d.map(e=>{const f={...e,_id:k(e._id)},m=i==="published"?R:n.observeForPreview(f,r.get(f._type)).pipe(y(),I(o=>o.snapshot===null)),h={...e,_id:v(e._id)},w=n.observeForPreview(h,r.get(h._type));return D(w.pipe(U(m)),m).pipe(j(o=>!!o.snapshot),F(o=>{const c=o.snapshot;return{_id:v(c._id),title:c.title,subtitle:c.subtitle,description:c.description,imageUrl:c.imageUrl}}))}))),M(0)),[n,p,r,i]),l=s.useRef([]);return s.useEffect(()=>{const d=b.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),l.current=e});return()=>{d.unsubscribe()}},[t,b]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:l.current})),[t]),s.useEffect(()=>{p.next(a)},[a,p]),null};var W=s.memo(L);export{W as default};
